spack:
  # CUSTOM MODULES
  # these modifications blacklist the system compiler to make Core packages
  # this streamlines the lmod tree that we expose to the users
  config:
    module_roots: 
      lmod: ./lmod
  modules:
    enable:
    - lmod
    lmod:
      core_compilers:
      - &gcc_back !osp_system_compiler
      hash_length: 0
      hierarchy:
      - compiler
      - mpi
      whitelist:
      - gcc
      blacklist:
      - !compiler [*gcc_back]
      projections:
        all: '{architecture}/{compiler.name}/{compiler.version}/{name}/{version}'
    default:
      arch_folder: false
      lmod:
        core_compilers:
        - *gcc_back
        # the hash_length and blacklist_implicits options do not work above in the lmod
        #   section. instead they *must* be placed here in the default section
        hash_length: 0
        blacklist_implicits: true
  # EXTERNAL packages
  packages:
    intel:
      buildable: false
      externals:
      - prefix: /cm/shared/apps/Intel/2020/
        spec: !cat [intel@19.1.2.254, !compiler [*gcc_back]]
      - prefix: /cm/shared/apps/Intel/2021/
        spec: !cat [intel@2021.4.0, !compiler [*gcc_back]]
    slurm:
      buildable: false
      externals:
      - prefix: /cm/shared/apps/slurm/current
        spec: slurm@19.05.7
  # beware that we use lists of lists
  specs:
  # compiler: intel@2021
  - - &intel21 !cat
      - intel@2021.4.0
      - arch=linux-centos8-cascadelake
      - !compiler [*gcc_back]
  # packages compiled with intel 21
  - !osp_compiled
    compiler: *intel21
    specs:
    - git
    # pythons
    - &py399 !cat 
      - python@3.9.9 
      - &pybase +bz2 +ctypes +dbm ~debug +ensurepip +libxml2 +lzma ~nis +optimizations +pic
        +pyexpat +pythoncmd +readline +shared +sqlite3 +ssl ~tix ~tkinter ~ucs4 +uuid +zlib
    - &py3812 !cat [python@3.8.12, *pybase]
  compilers:
  - compiler:
      spec: intel@19.1.2.254
      paths:
        cc: /cm/shared/apps/Intel/2020/compilers_and_libraries_2020.2.254/linux/bin/intel64/icc
        cxx: /cm/shared/apps/Intel/2020/compilers_and_libraries_2020.2.254/linux/bin/intel64/icpc
        f77: /cm/shared/apps/Intel/2020/compilers_and_libraries_2020.2.254/linux/bin/intel64/ifort
        fc: /cm/shared/apps/Intel/2020/compilers_and_libraries_2020.2.254/linux/bin/intel64/ifort
      flags: {}
      operating_system: centos8
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: dpcpp@2021.4.0
      paths:
        cc: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/icx
        cxx: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/dpcpp
        f77: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/ifx
        fc: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/ifx
      flags: {}
      operating_system: centos8
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: intel@2021.4.0
      paths:
        cc: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/intel64/icc
        cxx: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/intel64/icpc
        f77: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/intel64/ifort
        fc: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/intel64/ifort
      flags: {}
      operating_system: centos8
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: oneapi@2021.4.0
      paths:
        cc: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/icx
        cxx: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/icpx
        f77: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/ifx
        fc: /cm/shared/apps/Intel/2021/compiler/2021.4.0/linux/bin/ifx
      flags: {}
      operating_system: centos8
      target: x86_64
      modules: []
      environment: {}
      extra_rpaths: []
